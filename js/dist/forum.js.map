{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@nearata/flarum-ext-related-discussions/./src/forum/components/RelatedDiscussionList.tsx","webpack://@nearata/flarum-ext-related-discussions/./src/forum/index.tsx","webpack://@nearata/flarum-ext-related-discussions/./src/forum/states/RelatedDiscussionState.ts","webpack://@nearata/flarum-ext-related-discussions/external root \"flarum.core.compat['common/Component']\"","webpack://@nearata/flarum-ext-related-discussions/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@nearata/flarum-ext-related-discussions/external root \"flarum.core.compat['common/components/Placeholder']\"","webpack://@nearata/flarum-ext-related-discussions/external root \"flarum.core.compat['common/extend']\"","webpack://@nearata/flarum-ext-related-discussions/external root \"flarum.core.compat['forum/app']\"","webpack://@nearata/flarum-ext-related-discussions/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@nearata/flarum-ext-related-discussions/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@nearata/flarum-ext-related-discussions/external root \"flarum.core.compat['forum/components/PostStream']\"","webpack://@nearata/flarum-ext-related-discussions/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@nearata/flarum-ext-related-discussions/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@nearata/flarum-ext-related-discussions/webpack/bootstrap","webpack://@nearata/flarum-ext-related-discussions/webpack/runtime/compat get default export","webpack://@nearata/flarum-ext-related-discussions/webpack/runtime/define property getters","webpack://@nearata/flarum-ext-related-discussions/webpack/runtime/hasOwnProperty shorthand","webpack://@nearata/flarum-ext-related-discussions/webpack/runtime/make namespace object"],"sourcesContent":["import RelatedDiscussionState from \"../states/RelatedDiscussionState\";\nimport Component from \"flarum/common/Component\";\nimport LoadingIndicator from \"flarum/common/components/LoadingIndicator\";\nimport Placeholder from \"flarum/common/components/Placeholder\";\nimport app from \"flarum/forum/app\";\nimport DiscussionListItem from \"flarum/forum/components/DiscussionListItem\";\nimport type Mithril from \"mithril\";\n\nexport default class RelatedDiscussionList extends Component {\n  relatedDiscussionState!: RelatedDiscussionState;\n  discussionId!: number;\n  position!: number;\n\n  oninit(vnode: Mithril.Vnode<this>) {\n    super.oninit(vnode);\n\n    this.position = vnode.attrs.position;\n\n    this.relatedDiscussionState = new RelatedDiscussionState(\n      vnode.attrs.discussionId\n    );\n    this.relatedDiscussionState.load();\n  }\n\n  content() {\n    if (this.relatedDiscussionState.isLoading()) {\n      return <LoadingIndicator />;\n    }\n\n    if (!this.relatedDiscussionState.getData().length) {\n      return (\n        <Placeholder\n          text={app.translator.trans(\n            \"badlogic-related-discussions.forum.no_results\"\n          )}\n        />\n      );\n    }\n\n    return this.relatedDiscussionState.getData().map((discussion, index) => {\n      return (\n        <li\n          data-id={discussion.id()}\n          role=\"article\"\n          aria-setsize=\"-1\"\n          aria-posinset={index}\n        >\n          <DiscussionListItem discussion={discussion} params={{}} />\n        </li>\n      );\n    });\n  }\n\n  view() {\n    return (\n      <div\n        class={`DiscussionList badlogicRelatedDiscussions position${this.position}`}\n      >\n        <h3 class=\"h3 DiscussionList-title\">\n          {app.translator.trans(\n            \"badlogic-related-discussions.forum.discussion_list_title\"\n          )}\n        </h3>\n        <ul class=\"DiscussionList-discussions\" role=\"feed\">\n          {this.content()}\n        </ul>\n      </div>\n    );\n  }\n}\n","import RelatedDiscussionList from \"./components/RelatedDiscussionList\";\nimport { extend } from \"flarum/common/extend\";\nimport app from \"flarum/forum/app\";\nimport DiscussionPage from \"flarum/forum/components/DiscussionPage\";\nimport PostStream from \"flarum/forum/components/PostStream\";\n\nalert(\"Hello world\");\n\napp.initializers.add(\"badlogic-related-discussions\", () => {\n  extend(PostStream.prototype, \"view\", function (element) {\n    const allowGuests = app.forum.attribute(\n      \"badlogicRelatedDiscussionsAllowGuests\"\n    );\n\n    if (!app.session.user && !allowGuests) {\n      return;\n    }\n\n    const discussionId = this.discussion.id();\n    const position: string = app.forum.attribute(\n      \"badlogicRelatedDiscussionsPosition\"\n    );\n    const key = \"badlogicRelatedDiscussions\";\n\n    if (position === \"first_post\") {\n      element.children?.splice(\n        1,\n        0,\n        <RelatedDiscussionList\n          key={key}\n          discussionId={discussionId}\n          position={1}\n        />\n      );\n    }\n\n    if (position === \"last_post\") {\n      element.children?.splice(\n        element.children.length - 1,\n        0,\n        <RelatedDiscussionList\n          key={key}\n          discussionId={discussionId}\n          position={2}\n        />\n      );\n    }\n  });\n\n  extend(DiscussionPage.prototype, \"mainContent\", function (items) {\n    const allowGuests = app.forum.attribute(\n      \"badlogicRelatedDiscussionsAllowGuests\"\n    );\n\n    if (!app.session.user && !allowGuests) {\n      return;\n    }\n\n    const discussionId = this.discussion?.id();\n    const position: string = app.forum.attribute(\n      \"badlogicRelatedDiscussionsPosition\"\n    );\n\n    if (position === \"reply_block\") {\n      items.add(\n        \"badlogicRelatedDiscussions\",\n        <RelatedDiscussionList discussionId={discussionId} position={3} />\n      );\n    }\n  });\n});\n","import Discussion from \"flarum/common/models/Discussion\";\nimport app from \"flarum/forum/app\";\n\nexport default class RelatedDiscussionState {\n  discussionId: number;\n  loading: boolean;\n  data: Array<Discussion>;\n\n  constructor(discussionId: number) {\n    this.discussionId = discussionId;\n    this.loading = true;\n    this.data = [];\n  }\n\n  load(): void {\n    app.store\n      .find(\"discussions\", {\n        \"filter[badlogicRelatedDiscussions]\": this.discussionId,\n      })\n      .then((r: any) => {\n        this.data.push(...r);\n      })\n      .catch((e) => console.error(e))\n      .finally(() => {\n        this.loading = false;\n        m.redraw();\n      });\n  }\n\n  isLoading(): boolean {\n    return this.loading;\n  }\n\n  getData(): Array<Discussion> {\n    return this.data;\n  }\n}\n","module.exports = flarum.core.compat['common/Component'];","module.exports = flarum.core.compat['common/components/LoadingIndicator'];","module.exports = flarum.core.compat['common/components/Placeholder'];","module.exports = flarum.core.compat['common/extend'];","module.exports = flarum.core.compat['forum/app'];","module.exports = flarum.core.compat['forum/components/DiscussionListItem'];","module.exports = flarum.core.compat['forum/components/DiscussionPage'];","module.exports = flarum.core.compat['forum/components/PostStream'];","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};"],"names":["RelatedDiscussionState","Component","LoadingIndicator","Placeholder","app","DiscussionListItem","RelatedDiscussionList","_Component","_inheritsLoose","_this","_len","arguments","length","args","Array","_key","call","apply","concat","relatedDiscussionState","discussionId","position","_proto","prototype","oninit","vnode","attrs","load","content","isLoading","m","getData","text","translator","trans","map","discussion","index","id","role","params","view","default","extend","DiscussionPage","PostStream","alert","initializers","add","element","allowGuests","forum","attribute","session","user","key","_element$children","children","splice","_element$children2","items","_this$discussion","loading","data","store","find","then","r","_this$data","push","e","console","error","redraw","setPrototypeOf","subClass","superClass","Object","create","constructor","_setPrototypeOf","o","p","bind","__proto__"],"sourceRoot":""}